{% extends 'template.twig' %}
{% block form %}
    <div class="form-group">
        <label for="aes">Votre texte</label>
        {% if plain is defined %}
            <textarea class="form-control" id="aes" name="aes" value="{{ plain }}"></textarea>
        {% else %}
            <textarea class="form-control" id="aes" name="aes"></textarea>
        {% endif %}
    </div>
    <div class="form-group">
        <label for="file">Ou uploader un fichier</label>
        <input type="file" class="form-control-file" id="file" name="file" onchange="readFile('aes')">
    </div>
    <div class="form-group">
        <label for="key">Votre clé</label>
        {% if key is defined %}
            <textarea class="form-control" id="key" name="key" value="{{ key }}"></textarea>
        {% else %}
            <textarea class="form-control" id="key" name="key"></textarea>
        {% endif %}
    </div>
    
    <div class="form-group">
        <label for="type">Type</label>
        <select class="form-control" name="type" id="type">
            <option value="1">Encrypter</option>
            <option value="2">Décrypter</option>
        </select>
        <button type="submit" style="margin-top: 10px;" class="btn btn-primary">Envoyer</button>
    </div>

    <div class="form-group">
        {% if res is defined %}
            <label for="textval">Résultat :</label>
            <textarea class="form-control" id="my-textarea">{{ res }}</textarea>
        {% endif %}
    </div>

    {% if res is defined %}
    <div class="form-group">
        <button type="button" onclick="download('key-aes')" class="btn btn-primary">Sauvegarder</button>
    </div>
    {% endif %}

<script>
	function readFile(textarea_name) {
        let input = document.getElementById('file');
        let textarea = document.getElementById(textarea_name);

        let files = input.files;

        if (files.length == 0) return;
        const file = files[0];

        let reader = new FileReader();

        reader.onload = (e) => {
            const file = e.target.result;

            const lines = file.split(/\r\n|\n/);
            textarea.value = lines.join('\n');
            $('#form-crypto').submit();
        };
        reader.onerror = (e) => alert(e.target.error.name);
        reader.readAsText(file);
    }
</script>

{% endblock %}